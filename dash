Below is a consolidated implementation that includes all of the Power Query M code for your key tables (Snapshots, Org Mapping, Personnel Actions and Date) followed by DAX measures for attrition, retention and the advanced statistics. You can paste each section into the Advanced Editor of its respective query in Power BI Desktop and then define the DAX measures in the model.

⸻

✅ Power Query M Code

1. Snapshots query (appends all quarterly snapshot files)

let
    // Connect to the folder containing all snapshot files
    Source = Folder.Files("C:\\Data\\DISA_Snapshots"),
    Filtered = Table.SelectRows(Source, each Text.StartsWith([Name], "DISA Empl Data")),

    // Extract snapshot date from file name "DISA Empl Data dd Mmm yy.xlsx"
    AddSnapshotDate = Table.AddColumn(Filtered, "SnapshotDate", each
        let
            DateString = Text.Trim(Text.Middle([Name], 15, 9)), // "01 Oct 24"
            DayPart   = Text.Start(DateString, 2),
            MonthPart = Text.Middle(DateString, 3, 3),
            YearPart  = Text.End(DateString, 2),
            ParsedDate = Date.FromText(DayPart & " " & MonthPart & " 20" & YearPart)
        in
            ParsedDate
    ),

    // Expand each workbook into a unified table
    AddWorkbook = Table.AddColumn(AddSnapshotDate, "Data", each Excel.Workbook([Content], true)),
    ExpandWB = Table.ExpandTableColumn(AddWorkbook, "Data", {"Data"}, {"Data"}),
    ExpandSheet = Table.ExpandTableColumn(ExpandWB, "Data", {"Data"}, {"SheetData"}),
    ExpandRows = Table.ExpandTableColumn(ExpandSheet, "SheetData", Table.ColumnNames(ExpandSheet{0}[SheetData])),

    // Cast important fields
    ChangedTypes = Table.TransformColumnTypes(
        ExpandRows,
        {
            {"DoD ID (EDIPI)", type text},
            {"Org Structure ID", type text},
            {"Title", type text},
            {"Occ Series Current", type text},
            {"Manpower PCN", type text},
            {"ServiceStartDate", type date},     // adjust to your actual column names
            {"DateOfBirth", type date}           // adjust to your actual column names
        }
    ),

    // Derive the two‑character org code
    AddOrgFirst2 = Table.AddColumn(ChangedTypes, "OrgFirst2", each Text.Start([Org Structure ID], 2), type text),

    // Merge in org hierarchy from DimOrg
    MergedOrg = Table.NestedJoin(AddOrgFirst2, {"OrgFirst2"}, DimOrg, {"Org"}, "OrgDetails", JoinKind.LeftOuter),
    ExpandedOrg = Table.ExpandTableColumn(MergedOrg, "OrgDetails", {"Center","Org Code","CAM ID"}, {"Center","Org Code","CAM ID"}),

    // Flag students/interns
    AddStudentIntern = Table.AddColumn(
        ExpandedOrg,
        "StudentIntern",
        each
            let
                titleCheck = Text.Contains(Text.Lower([Title]), "student"),
                seriesCheck = Text.EndsWith(Text.From([Occ Series Current]), "99"),
                pcn = [Manpower PCN]
            in
                if (titleCheck or seriesCheck) and not (Text.Contains(pcn, "RG") or Text.Contains(pcn, "VT"))
                then 1 else 0,
        Int64.Type
    ),

    // Tenure (years) and age (years)
    AddTenure = Table.AddColumn(
        AddStudentIntern,
        "TenureYears",
        each Number.RoundDown(Duration.Days([SnapshotDate] - [ServiceStartDate]) / 365, 2),
        type number
    ),
    AddAge = Table.AddColumn(
        AddTenure,
        "AgeYears",
        each Number.RoundDown(Duration.Days([SnapshotDate] - [DateOfBirth]) / 365, 2),
        type number
    ),

    // Tenure and age brackets
    AddTenureBracket = Table.AddColumn(
        AddAge,
        "TenureBracket",
        each
            if [TenureYears] < 1 then "<1 year"
            else if [TenureYears] < 3 then "1–2 years"
            else if [TenureYears] < 5 then "3–4 years"
            else if [TenureYears] < 10 then "5–9 years"
            else "10+ years",
        type text
    ),
    AddAgeBracket = Table.AddColumn(
        AddTenureBracket,
        "AgeBracket",
        each
            if [AgeYears] < 25 then "Under 25"
            else if [AgeYears] <= 35 then "25–35"
            else if [AgeYears] <= 50 then "36–50"
            else "50+",
        type text
    ),

    // Flag new hires (joined within 2 years of first snapshot date)
    EarliestSnapshotDate = #date(2024,10,1), // change to your earliest snapshot
    AddNewHireFlag = Table.AddColumn(
        AddAgeBracket,
        "NewHireFlag",
        each if [ServiceStartDate] >= Date.AddYears(EarliestSnapshotDate, -2) then 1 else 0,
        Int64.Type
    )

in
    AddNewHireFlag

2. DimOrg query (organisation mapping)

let
    Source = Excel.Workbook(File.Contents("C:\\Data\\OrgMAPPING.xlsx"), true),
    Sheet  = Source{[Item="Sheet1",Kind="Sheet"]}[Data],
    PromotedHeaders = Table.PromoteHeaders(Sheet, [PromoteAllScalars=true]),
    Types = Table.TransformColumnTypes(
        PromotedHeaders,
        {
            {"Org", type text},
            {"Center", type text},
            {"Org Code", type text},
            {"CAM ID", type text}
        }
    )
in
    Types

3. PersonnelActions query (fact table for losses and moves)

let
    Source = Excel.Workbook(File.Contents("C:\\Data\\KW DISA Personnel Actions new.xlsx"), true),
    Sheet  = Source{[Item="Sheet1",Kind="Sheet"]}[Data],
    PromotedHeaders = Table.PromoteHeaders(Sheet, [PromoteAllScalars=true]),

    // Trim two‑character org codes from the long lines
    AddFromOrgTrim = Table.AddColumn(
        PromotedHeaders,
        "FromOrgTrim",
        each Text.Start(Text.Trim(Text.AfterDelimiter([FROM_POSITION_ORG_LINE6_14], "-", 0)), 2),
        type text
    ),
    AddToOrgTrim = Table.AddColumn(
        AddFromOrgTrim,
        "ToOrgTrim",
        each Text.Start(Text.Trim(Text.AfterDelimiter([TO_POSITION_ORG_LINE6_22], "-", 0)), 2),
        type text
    ),

    // Set date types
    ChangedTypes = Table.TransformColumnTypes(
        AddToOrgTrim,
        {
            {"EFFECTIVE_DATE_4", type date},
            {"DT_ARR_SVCG_CCPO", type date},
            {"FIRST_NOA_CODE_5A", type text},
            {"FIRST_NOA_DESC_5B", type text},
            {"FIRST_ACTION_LA_CODE2_5E", type text},
            {"FROM_OCC_CODE_9", type text},
            {"TO_OCC_CODE_17", type text}
            // add other columns here…
        }
    ),

    // 1. Flag organisation change or external departure
    AddFromToDifferent = Table.AddColumn(
        ChangedTypes,
        "FromToDifferent",
        each
            if
                Text.Start([FROM_POSITION_ORG_LINE6_14], 2) <> Text.Start([TO_POSITION_ORG_LINE6_22], 2)
                or List.Contains({"CAO", "T352"}, [FIRST_NOA_CODE_5A])
                or Text.Start([FIRST_NOA_CODE_5A], 1) = "3"
            then 1 else 0,
        Int64.Type
    ),

    // 2. Flag job series change
    AddSeriesChange = Table.AddColumn(
        AddFromToDifferent,
        "SeriesChange",
        each
            if
                [FROM_OCC_CODE_9] <> [TO_OCC_CODE_17]
                or List.Contains({"CAO", "T352"}, [FIRST_NOA_CODE_5A])
                or Text.Start([FIRST_NOA_CODE_5A], 1) = "3"
            then 1 else 0,
        Int64.Type
    ),

    // 3. Classify movement type
    AddMovementType = Table.AddColumn(
        AddSeriesChange,
        "MovementType",
        each
            if Text.Start([FIRST_NOA_CODE_5A], 1) = "3" or List.Contains({"CAO", "T352"}, [FIRST_NOA_CODE_5A]) then "External"
            else if List.Contains({"501","570","702","721"}, [FIRST_NOA_CODE_5A]) then "Internal"
            else "Other",
        type text
    ),

    // 4. Derive departure reason
    AddDepartureReason = Table.AddColumn(
        AddMovementType,
        "DepartureReason",
        each
            let lac2 = [FIRST_ACTION_LA_CODE2_5E]
            in
                if lac2 = "ADR" then "DoD‑DRP2"
                else if lac2 = "RZM" then "DoD‑DRP1"
                else if lac2 = "AZM" then "VERA/VSIP"
                else [FIRST_NOA_DESC_5B],
        type text
    ),

    // Optional numeric flag for external departures
    AddExternalFlag = Table.AddColumn(
        AddDepartureReason,
        "ExternalFlag",
        each if [MovementType] = "External" then 1 else 0,
        Int64.Type
    )

in
    AddExternalFlag

4. DimDate query (date dimension)

let
    StartDate = #date(2020, 1, 1),
    EndDate   = Date.EndOfYear(DateTime.Date(DateTime.LocalNow())),

    Dates = List.Dates(StartDate, Duration.Days(EndDate - StartDate) + 1, #duration(1, 0, 0, 0)),
    DateTable = Table.FromList(Dates, Splitter.SplitByNothing(), {"Date"}),
    AddYear   = Table.AddColumn(DateTable, "Year", each Date.Year([Date]), Int64.Type),
    AddMonthNum = Table.AddColumn(AddYear, "MonthNumber", each Date.Month([Date]), Int64.Type),
    AddMonthName = Table.AddColumn(AddMonthNum, "MonthName", each Date.ToText([Date], "MMM"), type text),
    AddQuarter = Table.AddColumn(AddMonthName, "Quarter", each Date.QuarterOfYear([Date]), Int64.Type)
in
    AddQuarter


⸻

✅ DAX Measures

Once the data model is loaded (with relationships between DimOrg, Snapshots, PersonnelActions, and DimDate), define these measures in your model. They are designed to work with the “Earlier Snapshot” and “Later Snapshot” slicers bound to Snapshots[SnapshotDate].

// Selected dates from slicers
SelectedStartDate = MIN ( Snapshots[SnapshotDate] )
SelectedEndDate   = MAX ( Snapshots[SnapshotDate] )

// On‑hand headcount at start and end (excluding students/interns)
OnHand_Start =
CALCULATE (
    DISTINCTCOUNT ( Snapshots[DoD ID (EDIPI)] ),
    Snapshots[SnapshotDate] = [SelectedStartDate],
    Snapshots[StudentIntern] = 0
)

OnHand_End =
CALCULATE (
    DISTINCTCOUNT ( Snapshots[DoD ID (EDIPI)] ),
    Snapshots[SnapshotDate] = [SelectedEndDate],
    Snapshots[StudentIntern] = 0
)

// Average headcount used as denominator for attrition
AverageOnHand = DIVIDE ( [OnHand_Start] + [OnHand_End], 2 )

// Losses between selected dates (external departures only)
Losses =
CALCULATE (
    DISTINCTCOUNT ( PersonnelActions[NAME_PERS_1] ),
    PersonnelActions[MovementType] = "External",
    PersonnelActions[EFFECTIVE_DATE_4] > [SelectedStartDate],
    PersonnelActions[EFFECTIVE_DATE_4] <= [SelectedEndDate]
)

// Attrition rate (as a percentage)
Attrition % =
DIVIDE ( [Losses], [AverageOnHand], 0 ) * 100

// Non‑voluntary attrition (NOA codes 330, 355, 357, 385)
NonVoluntaryLosses =
CALCULATE (
    DISTINCTCOUNT ( PersonnelActions[NAME_PERS_1] ),
    PersonnelActions[FIRST_NOA_CODE_5A] IN { "330", "355", "357", "385" },
    PersonnelActions[EFFECTIVE_DATE_4] > [SelectedStartDate],
    PersonnelActions[EFFECTIVE_DATE_4] <= [SelectedEndDate]
)
NonVoluntaryAttrition % =
DIVIDE ( [NonVoluntaryLosses], [AverageOnHand], 0 ) * 100

VoluntaryAttrition % = [Attrition %] - [NonVoluntaryAttrition %]

// Internal and external attrition rates
Internal Losses =
CALCULATE (
    DISTINCTCOUNT ( PersonnelActions[NAME_PERS_1] ),
    PersonnelActions[MovementType] = "Internal",
    PersonnelActions[EFFECTIVE_DATE_4] > [SelectedStartDate],
    PersonnelActions[EFFECTIVE_DATE_4] <= [SelectedEndDate]
)
External Losses =
CALCULATE (
    DISTINCTCOUNT ( PersonnelActions[NAME_PERS_1] ),
    PersonnelActions[MovementType] = "External",
    PersonnelActions[EFFECTIVE_DATE_4] > [SelectedStartDate],
    PersonnelActions[EFFECTIVE_DATE_4] <= [SelectedEndDate]
)

Internal Attrition % = DIVIDE ( [Internal Losses], [AverageOnHand], 0 ) * 100
External Attrition % = DIVIDE ( [External Losses], [AverageOnHand], 0 ) * 100

// Retained employees (present in both snapshots with same org/series)
RetainedTable =
SUMMARIZE (
    INTERSECT (
        VALUES ( Snapshots[DoD ID (EDIPI)] ),
        VALUES ( Snapshots[DoD ID (EDIPI)] )
    ),
    "EDIPI", Snapshots[DoD ID (EDIPI)],
    "StartOrg", CALCULATE ( SELECTEDVALUE ( Snapshots[OrgFirst2] ), Snapshots[SnapshotDate] = [SelectedStartDate] ),
    "EndOrg",   CALCULATE ( SELECTEDVALUE ( Snapshots[OrgFirst2] ), Snapshots[SnapshotDate] = [SelectedEndDate] ),
    "StartSeries", CALCULATE ( SELECTEDVALUE ( Snapshots[Occ Series Current] ), Snapshots[SnapshotDate] = [SelectedStartDate] ),
    "EndSeries",   CALCULATE ( SELECTEDVALUE ( Snapshots[Occ Series Current] ), Snapshots[SnapshotDate] = [SelectedEndDate] )
)

RetainedEmployees =
COUNTROWS ( FILTER ( RetainedTable, [StartOrg] = [EndOrg] ) )

Retention Rate % =
DIVIDE ( [RetainedEmployees], [OnHand_Start], 0 ) * 100

// New‑hire attrition
NewHire OnHand Start =
CALCULATE (
    DISTINCTCOUNT ( Snapshots[DoD ID (EDIPI)] ),
    Snapshots[SnapshotDate] = [SelectedStartDate],
    Snapshots[StudentIntern] = 0,
    Snapshots[NewHireFlag] = 1
)
NewHire OnHand End =
CALCULATE (
    DISTINCTCOUNT ( Snapshots[DoD ID (EDIPI)] ),
    Snapshots[SnapshotDate] = [SelectedEndDate],
    Snapshots[StudentIntern] = 0,
    Snapshots[NewHireFlag] = 1
)
NewHire Avg OnHand = DIVIDE ( [NewHire OnHand Start] + [NewHire OnHand End], 2 )

NewHire Losses =
CALCULATE (
    DISTINCTCOUNT ( PersonnelActions[NAME_PERS_1] ),
    PersonnelActions[MovementType] = "External",
    PersonnelActions[EFFECTIVE_DATE_4] > [SelectedStartDate],
    PersonnelActions[EFFECTIVE_DATE_4] <= [SelectedEndDate],
    RELATED ( Snapshots[NewHireFlag] ) = 1
)
NewHire Attrition % =
DIVIDE ( [NewHire Losses], [NewHire Avg OnHand], 0 ) * 100

// Average and median tenure
Average Tenure = AVERAGE ( Snapshots[TenureYears] )
Median Tenure =
MEDIANX (
    VALUES ( Snapshots[DoD ID (EDIPI)] ),
    Snapshots[TenureYears]
)
Formatted Average Tenure =
VAR AvgYears      = [Average Tenure]
VAR Years         = INT ( AvgYears )
VAR RemainingMonths = ROUND ( ( AvgYears - Years ) * 12, 0 )
RETURN
    IF (
        RemainingMonths = 0,
        FORMAT ( Years, "0" ) & " years",
        FORMAT ( Years, "0" ) & " years and " & FORMAT ( RemainingMonths, "0" ) & " months"
    )

These measures rely on the definitions of attrition and retention—attrition is the number of leavers divided by the average number of employees ￼, while retention rate is the complement of attrition ￼. Adjust column names to match your actual dataset, and the model will support dynamic comparisons between any two snapshot dates selected via slicers.
